<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phung's WebApp</title>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

 
  </head>
  <body>
     <!-- NAVBAR -->
  <nav class="z-depth-50 grey lighten-4" style="height: 100px">
    <div class="nav-wrapper container">
      <a href="#" class="brand-logo">
        <img src="/assets/tortie.png" style="width: 70px; height: 70px; border-radius: 50%; margin-top: 10px;">
      </a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
          <li class="logged-in">
            <a href="#" class="modal-trigger waves-light waves-ripple btn" data-target="modal-account">Account</a>
          </li>
          <li class="logged-in">
            <a href="#" class="modal-trigger waves-light waves-orange btn" id="logout">Logout</a>
          </li>
          <li class="logged-in">
            <a href="#" class="modal-trigger waves-light waves-ripple btn" data-target="modal-create">Create Guide</a>
          </li>
          <li class="logged-out">
            <a href="#" class="modal-trigger waves-light waves-ripple btn" data-target="modal-login">Login</a>
          </li>
          <li class="logged-out">
            <a href="#" class="modal-trigger waves-light waves-ripple btn" data-target="modal-signup">Sign up</a>
          </li>
        </span>
      </ul>
    </div>
  </nav>

  
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
  
    <script type="module" src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js"></script>
    <script type="module">
      
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js'
        import { getDatabase } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js'
        import { getAuth } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js'
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js'
        
      const firebaseConfig = {
        apiKey: "AIzaSyD9m74Ngn7FI82IM2YdXPGljvGbQSMvLUY",
        authDomain: "icebase-31674.firebaseapp.com",
        databaseURL: "https://icebase-31674-default-rtdb.firebaseio.com",
        projectId: "icebase-31674",
        storageBucket: "icebase-31674.appspot.com",
        messagingSenderId: "551544382823",
        appId: "1:551544382823:web:1a5c13dee46d1ad3b13bc2"
      };

       // Initialize Firebase
      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      // const firestore = firebase.firestore();
      const auth = app.auth();
      
      // db.settings({ timestampsInSnapshot: true })
      document.querySelector('#submit').addEventListener('click', () => { 
        let name = document.getElementById('name').value;
        let email = document.getElementById('email').value;
        let username = document.getElementById('username').value;
        db.ref('user-info/' + username).set({
          name: name,
          username: username,
          email:  email
        })
      })
        

        document.querySelector('#get').addEventListener('click', () => { 
        let name = document.getElementById('name').value;
        let email = document.getElementById('email').value;
        let username = document.getElementById('username').value;
        let user_ref = firebase.database().ref('user-info/' + username)
          user_ref.on('value', function(snapshot) {
            let data = snapshot.val()
            console.log(data.email)
          })
      })


      document.querySelector('#update').addEventListener('click', () => { 
        let name = document.getElementById('name').value;
        let email = document.getElementById('email').value;
        let username = document.getElementById('username').value;
        let updates = {
          name: name,
          username: username,
          email:  email
        }         
         firebase.database().ref('user-info/' + username).update(updates)
        })
      

        document.querySelector('#delete').addEventListener('click', () => { 
        let username = document.getElementById('username').value;
         firebase.database().ref('user-info/' + username).remove()
        })

        // Sign up

        const signUpForm = document.querySelector('#signup-form');

        // sign up, takes submit and turns it into an object event. 
        signUpForm.addEventListener('submit', (e) => {
        e.preventDefault();

        // assign values
        const email = signUpForm['signup-email'].value;
        const password = signUpForm['signup-password'].value;

        // creates account
        auth.createUserWithEmailAndPassword(email, password).then(cred=>{
          console.log(cred.user);

          // close the signup modal & reset form
          const modal = document.querySelector('#modal-signup');
          M.Modal.getInstance(modal).close();
          signUpForm.reset();
          })
        });
 

      </script>
       
  <!-- SIGN UP MODAL -->
<main>       
  <div id="modal-signup" class="modal">
    <div class="modal-content">
      <h4>Sign up</h4><br />
      <form id="signup-form">
        <div class="input-field">
          <input type="email" id="signup-email" required />
          <label for="signup-email">Email address</label>
        </div>
        <div class="input-field">
          <input type="password" id="signup-password" required />
          <label for="signup-password">Choose password</label>
        </div>
        <button class="btn yellow darken-2 z-depth-0">Sign up</button>
      </form>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div id="modal-login" class="modal">
    <div class="modal-content">
      <h4>Login</h4><br />
      <form id="login-form">
        <div class="input-field">
          <input type="email" id="login-email" required />
          <label for="login-email">Email address</label>
        </div>
        <div class="input-field">
          <input type="password" id="login-password" required />
          <label for="login-password">Your password</label>
        </div>
        <button class="btn yellow darken-2 z-depth-0">Login</button>
      </form>
    </div>
  </div>

  <!-- ACCOUNT MODAL -->
  <div id="modal-account" class="modal">
    <div class="modal-content center-align">
      <h4>Account details</h4><br />
      <div class="account-details"></div>
    </div>
  </div>

  <!-- CREATE GUIDE MODAL -->
  <div id="modal-create" class="modal">
    <div class="modal-content">
      <h4>Create Guide</h4><br />
      <form id="create-form">
        <div class="input-field">
          <input type="text" id="title" required>
          <label for="title">Guide Title</label>
        </div>
        <div class="input-field">
          <textarea id="content" class="materialize-textarea" required></textarea>
          <label for="content">Guide Content</label>
        </div>
        <button class="btn yellow darken-2 z-depth-0">Create</button>
      </form>
    </div>
  </div>

  <!-- GUIDE LIST -->
  <div class="container" style="margin-top: 40px;">
    <ul class="collapsible z-depth-0 guides" style="border: none;">
      <li>
        <div class="collapsible-header grey lighten-4">Guide title</div>
        <div class="collapsible-body white">Lorem ipsum dolor sit amet.</div>
      </li>
      <li>
        <div class="collapsible-header grey lighten-4">Guide title</div>
        <div class="collapsible-body white"><span>Lorem ipsum dolor sit amet.</span></div>
      </li>
      <li>
        <div class="collapsible-header grey lighten-4">Guide title</div>
        <div class="collapsible-body white"><span>Lorem ipsum dolor sit amet.</span></div>
      </li>
      <li>
        <div class="collapsible-header grey lighten-4">Guide title</div>
        <div class="collapsible-body white"><span>Lorem ipsum dolor sit amet.</span></div>
      </li>
    </ul>
  </div>

          <div class="container" style="position: absolute; bottom: 25%; left: 25%; width: 50%">
            <div class="row my-4">
            <input type="text" placeholder="name" class="text-center mx-3 border-1 rounded-md drop-shadow-md" id="name">
            <input type="text" placeholder="username" class="text-center mx-3 border-1 rounded-md drop-shadow-md" id="username">
            <input type="text" placeholder="email" class="text-center mx-3 border-1 rounded-md drop-shadow-md" id="email">
          </div>
            <div class="buttons text-center">
            <button id="submit" class="waves-effect waves-light btn">send</button>
            <button id="get" class="waves-effect waves-light btn">get</button>
            <button id="update" class="waves-effect waves-light blue light btn">update</button>
            <button id="delete" class="waves-effect waves-light red light btn">delete</button>
            </div>
      
          </main>
    </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="/js/global.js"></script>
  <script src="/js/auth.js"></script>

  </body>
</html>
